//NAME: Generic functions #2
//DESC:
//BEGIN CODE

extern fn free(ptr: *void) -> void;
extern fn printf(fmt: *u8, ...) -> i32;
extern fn malloc(size: usize) -> *u8;

fn map<T>(arr: []T, f: fn(T) -> T) -> *T {
  let result = malloc(arr.len * sizeof(T)) as *T;
  for (let i = 0; i < arr.len; i = i + 1) {
      result[i] = f(arr[i]);
  }
  return result;
}

fn successor<T>(x: T) -> T {
  return x + 1;
}

fn main() -> i32 {
  let arr: []i32 = {1,2,3,4,5};
  let k = map::<i32>(arr, &successor::<i32>);
  for (let i = 0; i < arr.len; i = i + 1) {
      printf("%d\n", k[i]);
  }
  free(k);
  let arr2: []f32 = {5,4,3,2,1};
  let k1 = map::<f32>(arr2, &successor::<f32>);
  for (let j = 0; j < arr2.len; j = j + 1) {
      printf("%f\n", k1[j]);
  }
  free(k1);
  return 0;
}


//END CODE
//BEGIN EXPECT
//2
//3
//4
//5
//6
//6.000000
//5.000000
//4.000000
//3.000000
//2.000000
//END EXPECT
